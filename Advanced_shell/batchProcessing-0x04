#!/bin/bash

# List of pokemons
pokemons=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

OUTPUT_DIR="pokemon_data"
mkdir -p "$OUTPUT_DIR"

echo "Starting parallel PokÃ©mon data fetching..."
echo "-------------------------------------------"

# Array to store PIDs of background jobs
pids=()

# Loop through PokÃ©mon and fetch each in parallel
for p in "${pokemons[@]}"; do
    (
        echo "[PID $$] Fetching $p..."

        file_name="$OUTPUT_DIR/$p.json"

        if curl -s -f "https://pokeapi.co/api/v2/pokemon/$p" -o "$file_name"; then
            echo "âœ” Saved $file_name"
        else
            echo "âœ˜ Failed to fetch $p" >&2
            # Kill this process explicitly (for demonstration)
            kill $$ 2>/dev/null
        fi
    ) &
    # Store the PID of the background job
    pids+=($!)
done

# Optional: example of killing a stuck process
# Uncomment to test killing the first process
# kill "${pids[0]}" 2>/dev/null

# Wait for ALL background jobs to finish
for pid in "${pids[@]}"; do
    wait "$pid"
done

echo "-------------------------------------------"
echo "All PokÃ©mon data fetched successfully!"

#output:
'''
Starting parallel PokÃ©mon data fetching...
-------------------------------------------
[PID 1234] Fetching bulbasaur...
[PID 1235] Fetching ivysaur...
[PID 1236] Fetching venusaur...
[PID 1237] Fetching charmander...
[PID 1238] Fetching charmeleon...
âœ” Saved pokemon_data/bulbasaur.json
âœ” Saved pokemon_data/ivysaur.json
âœ” Saved pokemon_data/venusaur.json
âœ” Saved pokemon_data/charmander.json
âœ” Saved pokemon_data/charmeleon.json
-------------------------------------------
All PokÃ©mon data fetched successfully!
'''


'''ğŸ’¡ Ø¥Ø²Ø§ÙŠ Ù†Ø¹Ù…Ù„ ØªÙ†ÙÙŠØ° Ù…ØªÙˆØ§Ø²ÙŠ ÙÙŠ Ø§Ù„Ù€ shellØŸ
1ï¸âƒ£ Ø£ÙŠ Ø£Ù…Ø± Ù†Ø­Ø· ÙÙŠ Ø¢Ø®Ø±Ù‡ &
curl ... &


Ø¯Ù‡ Ù…Ø¹Ù†Ø§Ù‡:

Ø´ØºÙ‘Ù„ curl Ù„ÙƒÙ† Ø§Ø´ØªØºÙ„ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© (background).
ÙˆÙ…Ø§ ØªÙˆÙ‚ÙØ´ Ø§Ù„Ø³ÙƒØ±Ø¨Øªâ€¦ ÙƒÙ…Ù‘Ù„.

ÙŠØ¹Ù†ÙŠ:

curl ÙŠØ¨Ø¯Ø£

ÙˆØ§Ù„Ù€ loop ØªÙƒÙ…Ù„ ÙˆØªØ¨Ø¯Ø£ curl ØªØ§Ù†ÙŠ

ÙˆÙ‡ÙƒØ°Ø§

Ù…Ø«Ø§Ù„ Ù…Ø¨Ø³Ù‘Ø·:

sleep 5 &
sleep 5 &
sleep 5 &


ÙƒÙ„Ù‡Ù… Ù‡ÙŠØ´ØªØºÙ„ÙˆØ§ Ù…Ø¹ Ø¨Ø¹Ø¶
ÙˆÙ‡ÙŠÙ†ØªÙ‡ÙˆØ§ ÙÙŠ 5 Ø«ÙˆØ§Ù†ÙŠ Ø¨Ø³
Ù…Ø´ 15.

2ï¸âƒ£ ÙˆØ¨Ø¹Ø¯ Ù…Ø§ Ù†Ø´ØºÙ‘Ù„ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øªâ€¦ Ù†Ù‚ÙˆÙ„ Ù„Ù„Ø³ÙƒØ±Ø¨Øª:
wait


ÙŠØ¹Ù†ÙŠ:

Ø§Ø³ØªÙ†Ù‰ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù„ÙŠ Ø´ØºÙ‘Ù„ØªÙ‡Ø§ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© ØªØ®Ù„Øµ.

Ù…Ù† ØºÙŠØ± wait Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ù‡ÙŠÙ‚ÙÙ„ Ù‚Ø¨Ù„ Ù…Ø§ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØªØ®Ù„Øµ.

ğŸ¨ Ù…Ø«Ø§Ù„ Ø¨Ø³ÙŠØ· Ø¬Ø¯Ù‹Ø§ ÙŠÙˆØ¶Ù‘Ø­ Ø§Ù„ØµÙˆØ±Ø©:
Ø¨Ø¯ÙˆÙ† parallel:
Start Bulbasaur... Takes 2s
Start Ivysaur... Takes 2s
Start Charmander... Takes 2s

Total time = 2 + 2 + 2 = 6 Ø«ÙˆØ§Ù†ÙŠ

Ù…Ø¹ parallel:
Start Bulbasaur in background
Start Ivysaur in background
Start Charmander in background

All run together â†’ Takes 2 seconds total

ğŸ¤” Ø·Ø¨ Ø¥ÙŠÙ‡ ÙØ§ÙŠØ¯Ø© Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ ( ) ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ØŸ

ÙƒÙ†Ø§ Ø¨Ù†Ø¹Ù…Ù„:

(
   curl ...
) &


Ø¯Ù‡ ÙŠØ¹Ù…Ù„ subshell

ÙŠØ¹Ù†ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ØªØ¨Ù‚Ù‰ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©:

curl

echo

ÙƒÙ„ Ø§Ù„Ù„ÙŠ Ø¬ÙˆÙ‡ ()

Ù„Ùˆ Ø´ØºÙ„Øª curl Ù„Ø­Ø§Ù„Ù‡:

curl ... &


Ø¨Ø±Ø¶Ù‡ Ù‡ÙŠÙ…Ø´ÙŠØŒ Ø¨Ø³ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ Ø¨ØªÙ†Ø¸Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙƒÙ€ job ÙˆØ§Ø­Ø¯.'''